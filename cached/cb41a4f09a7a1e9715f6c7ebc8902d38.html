<!DOCTYPE html> <html style lang=en><!--
 Page saved with SingleFile 
 url: https://lwn.net/Articles/899543/ 
 saved date: Sun Apr 23 2023 21:00:06 GMT+0800 (China Standard Time)
--><meta charset=utf-8><title>The trouble with symbolic links [LWN.net]</title>
<meta name=twitter:card content=summary>
<meta name=twitter:site content=@lwnnet>
<meta name=twitter:title content="The trouble with symbolic links">
<meta name=twitter:description content='At the 2022 sambaXP conference,
Jeremy Allison gave a talk titled "The UNIX Filesystem API is
profoundly broken: What to do about it?". LWN regulars may recall hints of
these talks in a recent comment
thread.  He started his talk with the problems that symbolic links
("symlinks")
cause for application developers, then discussed how the solutions to
the problems posed by symlinks led to substantial increases in the
complexity of the APIs involved in working with pathnames.
'>
<meta name=viewport content="width=device-width, initial-scale=1">
<link rel=alternate type=application/rss+xml title="LWN.net headlines" href=https://lwn.net/headlines/newrss>
<link rel=alternate type=application/rss+xml title="Comments posted to this article" href=https://lwn.net/headlines/899543/>
<style>body{color:black;background-color:#ffffff;padding:0px}h1{margin:0px 0px 5px 0px;padding:0px;color:black}h2{margin:20px 0px 5px 0px;padding:0px}h3{margin:0px 0px 5px 0px;padding:0px}a{text-decoration:underline}a:link{color:DarkBlue}a:visited{color:#444}a:hover{color:DarkBlue;background-color:#eeeeee}a:visited:hover{color:#444}a.name{color:black}a.name:link{color:black}a.name:hover{color:black}TABLE.HeadlineView{}TABLE.HeadlineView TD{vertical-align:top}DIV.PageHeadline{text-align:center;max-width:65em;margin-top:1em;margin-bottom:2em}DIV.PageHeadline H1{margin-bottom:0.2em}DIV.PageHeadline H2{margin-top:0.2em}H1.Cat1HL{background-color:#ffcc99;text-align:center;padding-top:3px;padding-bottom:5px;margin-bottom:0.2em}H2.Cat2HL{background-color:#ffcc99;font-weight:bold;padding-left:3px;margin-bottom:0.3em}H3.Cat3HL{background-color:#ffcc99;padding-left:3px;margin-bottom:0.3em}H3.SummaryHL{font-weight:bold;font-size:larger;text-decoration:underline;margin-top:0.4em;margin-bottom:0.4em}H3.SummaryHL A:link{color:black}H3.SummaryHL A:visited{color:black}P.IndexPrimary A:link{color:black}P.IndexPrimary A:visited{color:black}P.IndexSecondary A:link{color:black}P.IndexSecondary A:visited{color:black}TABLE.Form TH{text-align:left}SPAN.SpellingError{background-color:#eeeeee;color:black}Q{font-style:normal;font-weight:normal;color:darkred;background-color:white}Q::before{content:""}Q::after{content:""}DIV.ErrorWords{background-color:#eeeedd;border-style:groove;padding:3px 3px 2px 3px;margin:1px 5px 1px 0px}DIV.BigQuote{font-style:normal;font-weight:normal;color:darkred;background-color:white;margin-left:1cm;margin-right:1cm}DIV.BigQuote P{margin-top:1em;margin-bottom:0px}BLOCKQUOTE.bq{font-style:normal;font-weight:normal;color:darkred;background-color:white;margin-bottom:0px}BLOCKQUOTE.bq P{margin-top:1em;margin-bottom:0px}H2.Headline{background-color:#ffcc99;font-weight:bold;font-size:larger;padding-left:3px}DIV.Byline{font-size:smaller;text-align:center}DIV.SideBox{margin:1em 1px 1em 1px}DIV.SideBox P{text-indent:-1em;margin:0px 0px 1px 1em}DIV.SideBox P.Header{font-weight:bold;text-indent:0px;margin-left:0px}DIV.Comment{margin-left:1em;background-color:inherit}DIV.CommentSubtree{background-color:inherit}DIV.OldCommentSubtree{background-color:#cccccc}DIV.CommentBox,DIV.OldCommentBox{border-style:none none none solid;border-width:thin;max-width:65em;margin-top:1em;background-color:inherit}DIV.CommentBox{border-color:#ffcc99}DIV.OldCommentBox{border-color:#cccccc}H3.CommentTitle{padding:2px 2px 2px 4px;margin:0px}DIV.CommentBox H3.CommentTitle{background-color:#ffcc99}DIV.OldCommentBox H3.CommentTitle{background-color:#cccccc}DIV.CommentBody{padding:0px 4px 0px 4px;background-color:inherit}P.CommentPoster{margin-top:0px}div.CommentReplyButton{display:block;text-align:right;padding:4px}DIV.FormattedComment{}PRE.FormattedComment{font:inherit}DIV.FormattedComment PRE{font:inherit}.Form{background-color:#eeeeee;padding:3px;border-style:groove}TABLE.IndexEntries{background-color:#eeeeee;padding:3px;margin:5px;float:right}TABLE.IndexEntries TD:first-child{padding:1px 5px 1px 1px}TABLE.InvoiceItems{border:1px solid}TABLE.InvoiceItems TR{border:1px solid}A.Current{background-color:darkred;color:white}A.Other{}P.NextLink{text-align:right}SPAN.QuotedText{color:#990099}SPAN.SearchMatch{font-weight:bold;text-decoration:underline}SPAN.Subscription{color:green}SPAN.Smaller{font-size:small}SPAN.Bigger{font-size:large}SPAN.ReallySmall{font-size:x-small}TR.Even{background-color:#eeeeee}TR.Odd{}table.OddEven{border-collapse:separate}table.OddEven tr:nth-child(even){background-color:#ffffff}table.OddEven tr:nth-child(odd){background-color:#eeeeee}table.OddEven th{background-color:#ffffff}table.OddEven td{padding:3px}.s-nonexistent{background-color:red!important}.s-withdrawn{background-color:red!important}.s-in-progress{background-color:white!important}.s-submitted{background-color:yellow!important}.s-active{background-color:lightgreen!important}P.Headlines{margin-bottom:6px;text-indent:-1em;margin-left:1em;margin-top:0px}P.Feature{text-indent:-1em;margin-left:1em;margin-top:0px;margin-bottom:2px}P.ErrorMessage{color:red;margin-left:1cm;margin-right:1cm;font-weight:bold;font-size:large}A.NonActive{color:red;font-weight:bold}SPAN.red{color:red}P.IndexPrimary{margin-top:1em;margin-bottom:0px;font-weight:bold}P.IndexSecondary{margin-top:0px;text-indent:5mm;margin-bottom:0px}P.IndexEntry{text-indent:1cm;margin-top:0px;margin-bottom:0px}DIV.TextAd{width:150px;border-style:solid;border-width:thin;margin:0px auto 10px auto;background-color:white;color:black}P.TextAdHeader{background-color:#419d4a;color:white;margin-top:0px;margin-bottom:3px;text-align:center;font-weight:bold}P.TextAdLink{margin:2px}P.TextAdBody{margin:10px 2px 2px 2px}P.TextAdFooter{border-top-style:dotted;border-top-width:thin;text-align:center;background-color:#eeeeee;margin:2px 0px 0px 0px}TABLE.tlnav{width:100%;color:black;padding:2px}TABLE.tlrw{width:45%;float:right;background-color:#eeeedd;border-style:groove;margin:5px;float:right}TABLE.tlr{width:35%;float:right;background-color:#eeeedd;border-style:groove;margin:5px;float:right}TABLE.tllw{width:45%;float:left;background-color:#eeeedd;border-style:groove;margin:5px}TABLE.tll{width:35%;float:left;background-color:#eeeedd;border-style:groove;margin:5px}P.QuoteAttr{text-align:right}DIV.tlrw{width:45%;float:right;background-color:#eeeedd;border-style:groove;padding:3px 3px 0px 3px;margin:1px 0px 1px 5px}DIV.tlr{width:35%;float:right;background-color:#eeeedd;border-style:groove;padding:3px 3px 0px 3px;margin:1px 0px 1px 5px}DIV.tllw{width:45%;float:left;background-color:#eeeedd;border-style:groove;padding:3px 3px 0px 3px;margin:1px 5px 1px 0px}DIV.tll{width:35%;float:left;background-color:#eeeedd;border-style:groove;padding:3px 3px 0px 3px;margin:1px 5px 1px 0px}P.tlqa{text-align:right}.spacylist LI,DD{margin-bottom:0.5em}UL.tighter{margin-top:0px;margin-bottom:0px}UL.tighter LI{margin-top:2px;margin-bottom:2px}P.GuestAuthor{max-width:15em;float:right;background-color:#eeeeee;border-style:groove;padding:3px;margin:6px 0px 2px 5px;float:right}DIV.GAByline{max-width:15em;float:right;background-color:#eeeeee;border-style:groove;padding:3px;margin:6px 0px 2px 5px;float:right;text-align:center}DIV.GAByline P{margin:0px;text-align:left}DIV.GAByline P:first-child{font-weight:bold;text-align:center;margin-bottom:3px}DIV.GAByline HR{width:40%}DIV.FeatureByline{max-width:20em;float:left;background-color:#eeeeee;border-style:groove;margin:2px 5px 2px 0px;padding-bottom:5px;padding-right:25px;padding-left:5px}DIV.FeatureByline HR{width:40%}div.survey{margin-left:1cm}div.sv_mc{margin-left:10mm;margin-top:0cm}SPAN.PullQuote{max-width:30%;float:right;color:black;background-color:#eeeeee;margin:2px 0px 2px 5px;padding:5px 2px 5px 0.5em;border-style:none none none solid;border-color:#ffcc99;font-weight:normal;font-size:larger}SPAN.invisible{display:none}TABLE.CalM{width:100%;border-spacing:0}TR.CalM{border-left-style:groove}TD.CalMDate{background-color:#eeeeee;font-size:x-large;width:13%;border-left-style:groove;border-top-style:groove}TD.CalMEvent{font-size:smaller;vertical-align:middle;border-left-style:groove}TD.CalMContinue{font-size:smaller;vertical-align:middle;border-left-style:groove}TD.CalBlank{border-left-style:none}TD.CalMBottom{border-left-style:groove;border-bottom-style:groove}TD.CalMTop{border-left-style:none;border-top-style:groove}TD.CalMCorner{border-left-style:groove;border-top-style:groove}TD.CalMHeader{font-size:larger;font-weight:bold;text-align:center;width:13%;padding-top:20px;padding-bottom:10px}TD.CalMName{font-size:x-large;font-weight:bold;text-align:center;background-color:#eeeeee;margin-bottom:10px;border-top-style:groove;border-bottom-style:groove}TD.CalMArrow{vertical-align:middle;border-style:groove}DIV.ArticleText{margin:0px 0px 0px 0px;padding:0px 2px 0px 0px;max-width:65em}DIV.widepage DIV.ArticleText{max-width:999em!important}DIV.Printable{}DIV.Printable DIV.ArticleText{margin:0px 0px 0px 0px;padding:0px;max-width:none}DIV.BlurbText{margin:0px 0px 0px 0px;padding:0px}SPAN.UliMath{color:black;font-weight:bold}SPAN.UliInvSig{color:black;font-weight:bold;text-decoration:overline}DIV.promobox{float:left;background-color:#eeeedd;border-style:groove;padding:3px 3px 0px 3px;margin:1px 5px 1px 0px}UL.NoBullet{list-style-type:none}DIV.FilteredComment{display:none;background-color:#eeeeee}DIV.CommHdr{background-color:#eeeeee}DIV.ArticleText IMG.forcewhite{background-color:white}IMG.photo{max-width:100%}img.rthumb{width:200px;height:250px;border-style:none;padding:3px 0px 3px 3px;float:right;-moz-user-select:none;-webkit-user-select:none;user-select:none}img.lthumb{width:200px;height:250px;border-style:none;padding:3px 3px 3px 0px;float:left;-moz-user-select:none;-webkit-user-select:none;user-select:none}DIV.BlurbListing{padding-left:3px}.comment-title{width:98%}.comment-body{width:98%}.wide-form{width:95%;margin:0.1em 0.5em 0.1em 0.1em;padding:0.2em;background-color:#eeeeee;border-radius:0.5em}.covered{background:#eeeeee;color:#eeeeee}.covered::-moz-selection{background:#ffffff;color:black}.covered::selection{background:#ffffff;color:black}div.MLThread{max-height:15em;background:#eeeeee;overflow-y:scroll}label.SBHelp{float:right}label.SBHelp:after{content:"[Hide help]"}input.SBHelp{display:none}input[type=checkbox]:checked~label.SBHelp:after{content:"[Show search help]"}input[type=checkbox]:checked~div.SBHelp{display:none}div.AnnLine{display:flex;justify-content:space-between}div.AnnLine span{vertical-align:top;margin:0;padding:2px 2px;color:black}div.SummarySection div.AnnLine:nth-child(even) span{background-color:#eeeeee}div.SummarySection div.AnnLine:nth-child(even){background-color:#eeeeee}div.SummarySection div.AnnLine:nth-child(1) span{padding-top:0px}span.AnnAuthor{flex:0 0 15em}span.AnnSubject{flex-grow:1;text-align:left}span.AnnDate{text-align:right;flex-grow:0}div.FPBox{display:flex;flex-direction:column}div.FPLeft{margin-right:5px}input,select,textarea{font-family:inherit;font-size:inherit}FONT.SpellingError{background-color:#eeeeee}FONT.SearchItem{font-weight:bold;color:red}FONT.QuotedText{color:#990099}FONT.NonActive{color:red;font-weight:bold}.pure-g>div{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#menu{width:100%;position:fixed;top:0;left:0;right:0;background-color:#eeeeee;padding:0 0.2em 0 0.2em;overflow-y:visible;display:block;z-index:20;height:42px}#menu.scrollable{position:absolute}DIV.navmenu-container{margin-left:0.5em;margin-top:0.5em;min-width:70%;border-radius:0.8em;padding:0.1em;display:inline-block}ul.navmenu{list-style:none;position:relative;display:inline-table;padding:0;margin:0}.navmenu li{display:inline-block;margin-right:0.4em}.navmenu ul{display:none;position:absolute;top:100%;width:15em;list-style:none;z-index:10;background:#eeeeee;padding-left:0;margin-left:0;border-style:solid}.navmenu ul li{display:block;margin-top:0.2em;margin-left:0.2em;line-height:1.4}.navmenu ul li:first-child{margin-top:1.2em}.navmenu li:hover>ul{display:block}a.navmenu{color:black}.navmenu a{text-decoration:none}.navmenu a:hover{text-decoration:underline}.navmenu a:visited,.topnav-container a:visited{color:DarkBlue}a.navmenu::after{content:" ▶"}span.logo,span.logobl,img.logo{display:none}img.sslogo{float:left}div.logo{float:left}DIV.topnav-container{margin-left:0.5em;margin-top:45px;margin-right:0.5em;background:#eeeeee;border-radius:0.8em;padding:0.3em}div.flexcol{display:flex;flex-direction:column}div.middlecolumn{flex:5}div.rightcol{padding-top:5em;flex:0 1 content}@media screen and (min-width:48em){.rightcol{flex:0;min-width:120px}.rightcol_wpage{display:none}}@media screen and (min-width:120em){.rightcol{max-width:400px}.rightcol_wpage{display:inline-block;flex:1}}@media screen and (min-width:48em){.header,.content{padding-left:2em;padding-right:2em}div.maincolumn{padding-left:10em}div.flexcol{flex-direction:row}div.adminboxes{width:33%}#menu{display:block;width:9.6em;height:100%;bottom:0;overflow-y:visible}#menu:hover{overflow-y:auto}#menu.scrollable{position:fixed}div.navmenu-container{display:block;margin-top:120px;margin-left:0;padding:0}.navmenu ul{display:block;position:static;width:9.6em;border-style:none;top:0}.navmenu li{margin:0.5em 0 0 0.1em;width:100%}.navmenu ul li{margin:0.1em 0 0 0.5em;text-indent:-0.4em;padding-right:0;width:auto;line-height:1.2}.navmenu ul li:first-child{margin-top:0}a.navmenu::after{content:""}DIV.topnav-container{margin-left:10.5em;margin-top:0.5em}img.logo{padding-right:0.2em;display:inline;;float:left;position:absolute;top:3px;left:3px}span.logo{font-weight:bold;color:green;display:inline;font-size:180%;text-align:right;float:left;padding-left:60px;font-family:sans-serif;line-height:0.8;padding-top:0.3em}span.logobl{color:green;display:inline;font-size:80%;text-align:center;position:absolute;top:85px;left:5px;font-family:sans-serif}img.sslogo{display:none}div.fp-feature{padding-right:1em}div.FPBox{flex-direction:row}}.huge-only{display:none}@media screen and (min-width:80em){.huge-only{display:inline-block}}@media print{.not-print,.navmenu-container,.handset-only{display:none!important}#menu{position:absolute}}@media (max-width:48em){.handset-only{display:inline-block}.not-handset{display:none}}@media (min-width:48em){.handset-only{display:none}.not-handset{display:inline-block}}DIV.SideBox{font-size:smaller}DIV.ArticleText{padding-left:0.5em}H2.Headline{border-radius:0.5em;padding-left:6px}DIV.BlurbListing{padding-left:6px}TABLE.Form TD{padding:2px 5px 2px 5px}TABLE{border-collapse:separate;border-spacing:5px 0px}TABLE.AdminBox{padding:0;width:98%}TABLE.AdminBox TD{padding:0}PRE{white-space:pre;overflow:visible}H3.CommentTitle{border-radius:0 2em 2em 0}H1.Cat1HL{border-radius:0.5em}H2.Cat2HL{border-radius:0.5em;padding-left:0.3em;margin-left:-0.3em}H3.Cat3HL{border-radius:0.4em;padding-left:0.2em;margin-left:-0.2em}DIV.CommentBox,DIV.OldCommentBox{margin-left:0.2em}html{font-family:inherit;font:normal}.pure-g,.pure-g [class*="pure-u"]{font-family:inherit}body{font-family:inherit,serif}.lwn-u-1{zoom:1;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}input{background-color:#ffffff;color:black;padding:3px;border-radius:0.5em}input:focus{border-color:DarkBlue}input[type="submit"]{background-color:#eeeeee}input[type="submit"]:hover{background-color:#ccc}textarea{background:#ffffff;color:black;border-radius:0.5em;padding:3px}textarea:focus{border-color:DarkBlue}form.loginform{display:inline}div.MakeALink{display:none}</style>
<link rel=icon href="data:image/png;base64,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" type=image/png><style>.sf-hidden{display:none!important}</style><link rel=canonical href=https://lwn.net/Articles/899543/><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
 <body>
 <a name=t></a>
<div id=menu><a href=https://lwn.net/><img src=data:image/png;base64,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 class=logo alt="LWN.net Logo" border=0>
 <span class=logo>LWN<br>.net</span>
 <span class=logobl>News from the source</span></a>
 <a href=https://lwn.net/><img src=data:, class="sslogo sf-hidden" alt=LWN border=0></a><div class=navmenu-container>
 <ul class=navmenu>
 <li><a class=navmenu href=#t><b>Content</b></a><ul><li><a href=https://lwn.net/current/>Weekly Edition</a><li><a href=https://lwn.net/Archives/>Archives</a><li><a href=https://lwn.net/Search/>Search</a><li><a href=https://lwn.net/Kernel/>Kernel</a><li><a href=https://lwn.net/Security/>Security</a><li><a href=https://lwn.net/Calendar/>Events calendar</a><li><a href=https://lwn.net/Comments/unread>Unread comments</a><li><hr><li><a href=https://lwn.net/op/FAQ.lwn>LWN FAQ</a><li><a href=https://lwn.net/op/AuthorGuide.lwn>Write for us</a></ul></li>
<li><a class=navmenu href=#t><b>Edition</b></a><ul><li><a href=https://lwn.net/Articles/900300/>Return to the Front page</a></ul></li>
</ul></div>
</div> 
<div class=not-handset style=margin-left:10.5em;display:block>
 <div class=not-print> <div id=azk13321_leaderboard></div> </div>
 </div>
 <div class=topnav-container>
<div class=not-handset><form action=https://lwn.net/Login/ method=post name=loginform class=loginform>
 <label><b>User:</b> <input type=text name=Username value size=8 id=uc></label> 
 <label><b>Password:</b> <input type=password name=Password size=8 id=pc value></label> <input type=submit name=submit value="Log in"></form> |
 <form action=https://lwn.net/subscribe/ method=post class=loginform>
 <input type=submit name=submit value=Subscribe>
 </form> |
 <form action=https://lwn.net/Login/newaccount method=post class=loginform>
 <input type=submit name=submit value=Register>
 </form>
 </div>
 <div class="handset-only sf-hidden">
 /
 /
 
 </div>
 </div><div class="maincolumn flexcol">
<div class=middlecolumn>
<div class=PageHeadline>
<h1>The trouble with symbolic links</h1>
</div>
<div class=ArticleText>
<center>
 <table class=Form width=60%>
 <tbody><tr><td><b>LWN.net needs you!</b><p>Without subscribers, LWN would simply not exist. Please consider
 <a href=https://lwn.net/subscribe/>signing up for a subscription</a> and helping
 to keep LWN publishing</p></tr>
 </table>
 </center>
 <p>
 <div class=GAByline>
 <p>July 7, 2022</p>
 <p>This article was contributed by Chris Riddoch</p>
 </div>
<p>At the <a href=https://sambaxp.org/archive>2022 sambaXP conference</a>,
Jeremy Allison gave a talk titled "The UNIX Filesystem API is
profoundly broken: What to do about it?". LWN regulars may recall hints of
these talks in a recent <a href=https://lwn.net/Articles/882177/>comment
thread</a>. He started his talk with the problems that symbolic links
("symlinks")
cause for application developers, then discussed how the solutions to
the problems posed by symlinks led to substantial increases in the
complexity of the APIs involved in working with pathnames.</p>
<p>Allison explained that hard links were the first "interesting addition"
to the original Unix filesystem API; unlike symlinks, though, they are not
dangerous, and are, in fact, easy to use. A hard link is simply the connection between
a directory entry and the inode for the file (or directory) to which that
entry refers. Unix systems allow multiple links to any file, but require
that the inode and directory entries all reside on the same filesystem.
<p>
By contrast, symlinks contain another path as data, and
the kernel transparently operates on the file at that path when system calls
like <a href=https://man7.org/linux/man-pages/man2/open.2.html><tt>open()</tt></a>
or <a href=https://man7.org/linux/man-pages/man2/lchown.2.html><tt>chown()</tt></a>
are called on the symlink. This
seemingly innocuous feature led to the addition of incredible amounts of
complexity in the effort to fulfill the needs of programs that need to be
aware of whether a pathname contains a symlink or not. Such programs
include archival programs like <tt>tar</tt>, file synchronization and transfer
programs such as <tt>rsync</tt>, network filesystem servers like Samba, and
many more that suffer security 
problems as a result of not giving sufficient attention to symlinks in
pathnames.</p>
<p>The variety of security problems resulting from symlinks can be seen in a <a href="https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=symbolic+link">search
of
CVE entries</a>, which gave Allison 1,361 results when he ran it. These include
vulnerabilities that facilitate information disclosure, privilege
escalation, and arbitrary file manipulation including deletion, among other
attacks. Without discussing any specific CVE in detail, he gave an
example of the kind of security problem that can result from
symlink-related vulnerabilities.</p>
<p>An application running as root may try to check that
<tt>/data/mydir</tt> is a regular directory (not a symlink) before opening
the file <tt>/data/mydir/passwd</tt>. In between the
time the program does the directory check and the file open, an attacker
could replace the <tt>mydir</tt> directory with a symlink to <tt>/etc</tt>,
and now the file opened is, unexpectedly, <tt>/etc/passwd</tt>. This is a
kind of race condition known as a <a href=https://en.wikipedia.org/wiki/Time-of-check_to_time-of-use>time-of-check-to-time-of-use
(TOCTOU)</a>
race.</p>
<h4>Symlinks and complexity</h4>
<p>
<p>Symlinks were created, Allison theorized, because hard links are
restricted to linking within the same filesystem, so only symlinks (which
lack that restriction) could be
used if an administrator wanted to add new storage media without changing
the paths to users' data. He quoted an advertisement for 4.2BSD,
which touted, "This feature frees the user of the constraints of the strict
hierarchy that a tree structure imposes. This flexibility is essential for
good namespace management."</p>
<p>The addition of symlinks led to the <tt><a href=https://man7.org/linux/man-pages/man2/lstat.2.html>lstat()</a></tt>
system call, which provided the means to identify whether the last
component in a pathname is a symlink. This was, unfortunately,
insufficient for handling symlinks pointing to directories earlier in the
path, he explained. An application could attempt to check each component
of the path individually, but not atomically — another application
could make a change to one of the components during this process, leading
to security vulnerabilities.</p>
<p>An option to the <tt>open()</tt> system call, <tt>O_NOFOLLOW</tt>, exhibits
the same problem as <tt>lstat()</tt>. <tt>O_NOFOLLOW</tt> instructs the
system call to fail with <tt>ELOOP</tt> if the last component in the
pathname is a symbolic link, but it <i>only</i> checks the last component. The
<a href=https://man7.org/linux/man-pages/man3/realpath.3.html><tt>realpath()</tt></a>
C&nbsp;library function follows symlinks in a path and produces 
an absolute, canonical pathname that the application can then compare with
the original. Allison described this as an appealing but incorrect
solution to the problem. Another process could make a change in between
the time <tt>realpath()</tt> is called and another function is used to
manipulate the file in some fashion. In other words, the same TOCTOU race
applies here.
<p>Allison said that the <tt>openat()</tt> system call was designed as a
solution to this problem; it introduces the idea of referring to files with respect
to a directory that's indicated by an already-open file descriptor. The
only reliable way to identify a file's path is to walk the hierarchy using
multiple calls to <tt>openat()</tt>. Everything else would be vulnerable
to race conditions.</p>
<p>But Allison also pointed out the flaw in this technique. "You cannot
create a new directory with <tt>open()</tt>, you cannot remove a file, unlink a
file, or delete a directory with an <tt>open()</tt> call." So, more functions
following the pattern of <tt>openat()</tt> had to be created:
<a href=https://man7.org/linux/man-pages/man2/mkdir.2.html><tt>mkdirat()</tt></a>,
<a href=https://man7.org/linux/man-pages/man2/link.2.html><tt>linkat()</tt></a>,
<a href=https://man7.org/linux/man-pages/man2/unlink.2.html><tt>unlinkat()</tt></a>,
<a href=https://man7.org/linux/man-pages/man2/rename.2.html><tt>renameat()</tt></a>,
and more. Some are still missing, like
<tt>getxattrat()</tt> and <tt>setxattrat()</tt>. Some, like
<a href=https://man7.org/linux/man-pages/man2/lchown.2.html><tt>fchownat()</tt></a>
and <a href=https://man7.org/linux/man-pages/man2/access.2.html><tt>faccessat()</tt></a>, 
don't follow the pattern cleanly.
<p>Allison didn't mince words: "So our original clean and beautiful POSIX
filesystem API doesn’t look very clean and beautiful anymore...pathnames as
a concept are now utterly broken in POSIX." One could reasonably
attribute, in part at least,
any perceived bitterness to Allison's struggles with the <a href=https://lwn.net/Articles/884052/>long road 
to a fix for CVE-2021-20316</a> in Samba.</p>
<p>
Because of the talk's focus on the role of symlinks in complicating the
Unix pathname API, Allison did not directly raise the point that race
conditions involving pathnames can occur even without symlinks.
It seems a major source of complexity is the lack of a mechanism for
atomically batching together operations that involve walking directories
and symlinks to eventually perform some operation on a file.</p>
<h4>Workarounds</h4>
<p>
<p>Allison then explained the use of the <tt>O_PATH</tt> flag to
<tt>open()</tt>, which will return a file descriptor that is only useful
for passing to the <tt>*at()</tt> system calls as the <tt>dirfd</tt>
argument. Unfortunately for Samba, file descriptors opened with
<tt>O_PATH</tt> cannot be used for reading
or writing extended attributes. He found a workaround, demonstrated by a snippet
of code that he described as "one of the most beautiful hacks I’ve ever
seen, it’s so ugly it makes you want to vomit, but it’s amazing."</p>
<pre>    int fd = openat(dirfd, "file", O_PATH|O_NOFOLLOW);
    sprintf(buf, "/proc/self/fd/%d", fd);
    getxattr(buf, ea_name, value, size);
</pre>
<p>The contents of <tt>/proc/self/fd</tt> are symlinks that represent every
file descriptor the process has open. Allison explained the code: "If you
print into a buffer '<tt>/proc/self/fd/</tt>' and then the number of the
descriptor you just got back from O_PATH, you can then pass it to
<tt>getxattr()</tt> or <tt>setxattr()</tt> as a path, and it can’t be
symlink-raced." He wasn't sure
whether to attribute this code to Android or Red Hat developers, but a
similar use of <tt>/proc/self/fd/</tt> can be found in the <tt>open()</tt>
man page.
<p>Allison reiterated the main point of his talk: "The concept of
pathnames is unusable on POSIX, completely. For a non-trivial application,
for a regular person writing code on POSIX, you will have symlink races in
your code."</p>
<p>Examples of (since fixed) CVEs were then provided, including one in the
<a href=https://blog.rust-lang.org/2022/01/20/cve-2022-21658.html>Rust
standard library</a>, which was <a href=https://lwn.net/Articles/882070/>discussed
extensively</a> here. In the last few minutes of the talk, Allison
noted several proposed solutions offered by LWN readers, including <a href=https://lwn.net/Articles/882216/>a special <tt>prctl()</tt> call</a> and <a href=https://lwn.net/Articles/884413/>restrictions on when non-root
symlinks are followed</a>. He said that the <a href=https://lwn.net/Articles/882487/><tt>MOUNT_NOSYMFOLLOW</tt> mount
option</a>, which simply forbids following symlinks within a filesystem, is
his preferred solution: "It’s perfect. It does exactly what we need."
Allison's talk concluded on that point.</p>
<p>While it certainly seems desirable to forbid symlinks in the name of
cleaning up the POSIX API, they are a frequently used system-administration tool.
Several popular "symlink managers" exist. <a href=https://www.gnu.org/software/stow/>Gnu Stow</a>, for example,
provides a way for
administrators to install programs into a new directory hierarchy, such as
<tt>/usr/local/stow/packagename-version/</tt>, and then create forests of
symlinks from <tt>/usr/local/bin/example</tt> to
<tt>/usr/local/stow/packagename-version/bin/example</tt>, using the minimum
number of symlinks necessary. This makes it possible to "uninstall" a
package simply by removing the symlinks with the help of <tt>stow -D</tt>.
<p>
The <tt>/etc/alternatives</tt> system created by Debian allows
administrators to switch between substitutable packages in a similar
manner without forcing the uninstallation or reinstallation of either
package. In a similar vein, the <a href=https://nixos.org/>Nix</a> and <a href=https://guix.gnu.org/>Guix</a> distributions make heavy use of
symlinks — a Guix profile consists of a tree of symlinks to packages
installed within <tt>/gnu/store/</tt>, making it easy to switch between
grouped combinations of specific versions of packages.</p>
<p>Banning symlinks entirely would break these use cases, but restricting
their creation to the root user would most likely suffice. Users may still have
other legitimate needs for symlinks, though, and substantially restricting
them would likely be an unpopular change.</p>
<p>SambaXP has made the talk's <a href="https://www.youtube.com/watch?v=4JrY-DntoyU">video</a> and <a href=https://sambaxp.org/fileadmin/user_upload/sambaxp2022-Slides/Allison-Symlinks_considered_harmful.pdf>slides</a>
available.</p><br clear=all><table class=IndexEntries>
 <tbody><tr><th colspan=2>Index entries for this article</tr>
 <tr><td><a href=https://lwn.net/Kernel/Index>Kernel</a><td><a href=https://lwn.net/Kernel/Index#Symbolic_links>Symbolic links</a></tr>
 <tr><td><a href=https://lwn.net/Archives/GuestIndex/>GuestArticles</a><td><a href=https://lwn.net/Archives/GuestIndex/#Riddoch_Chris>Riddoch, Chris</a></tr>
 </table><br clear=all>
<hr width=60% align=left>
 (<a href="https://lwn.net/Login/?target=/Articles/899543/">Log in</a> to post comments)
 <p>
 
</p></div> 
<p><a name=Comments></a>
<a name=CommAnchor900308></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 14:54 UTC (Thu) by <b>kees</b> (subscriber, #27264)
 [<a href=https://lwn.net/Articles/900308/>Link</a>]
 </p>
 <div class=FormattedComment>
I love nosymfollow! :) Since v5.10:<br>
<a href=https://git.kernel.org/linus/dab741e0e02bd3c4f5e2e97be74b39df2523fc6e>https://git.kernel.org/linus/dab741e0e02bd3c4f5e2e97be74b...</a><br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900308/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900329></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 17:02 UTC (Thu) by <b>adobriyan</b> (subscriber, #30858)
 [<a href=https://lwn.net/Articles/900329/>Link</a>]
 </p>
 <div class=FormattedComment>
Should be nosymlinkfollow but naming is the hardest part.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900329/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor900375></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 1:10 UTC (Fri) by <b>himi</b> (subscriber, #340)
 [<a href=https://lwn.net/Articles/900375/>Link</a>]
 </p>
 <div class=FormattedComment>
Damn . . . I scrolled down to the bottom of that changeset and was like "huh? where's the rest?" Is that literally all that's required to implement this properly?<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900375/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900462></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 14:54 UTC (Fri) by <b>harisphnx</b> (subscriber, #139363)
 [<a href=https://lwn.net/Articles/900462/>Link</a>]
 </p>
 <div class=FormattedComment>
An example of a good design?<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900462/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900630></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 11, 2022 13:07 UTC (Mon) by <b>scientes</b> (subscriber, #83068)
 [<a href=https://lwn.net/Articles/900630/>Link</a>]
 </p>
 <div class=FormattedComment>
This is what Sys 4 UNIX *didn't* do because they were too lazy to update all the binaries, and instead preferred to change the data structure through extension wihout thinking out the consequences. Nothing new.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900630/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900310></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 15:32 UTC (Thu) by <b>Sesse</b> (subscriber, #53779)
 [<a href=https://lwn.net/Articles/900310/>Link</a>]
 </p>
 <div class=FormattedComment>
I believe it's a bit of a stretch to say that “pathnames as a concept are now utterly broken in POSIX” just because userspace cannot verify that a path name is contained within some arbitrary part of the file system. Most applications will not have to care whether there's a directory symlink in the path, even if Samba needs to do its own userspace chroot.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900310/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900314></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 16:07 UTC (Thu) by <b>khim</b> (subscriber, #9252)
 [<a href=https://lwn.net/Articles/900314/>Link</a>]
 </p>
 <font class=QuotedText>&gt; I believe it's a bit of a stretch to say that “pathnames as a concept are now utterly broken in POSIX” just because userspace cannot verify that a path name is contained within some arbitrary part of the file system.</font>
<p>It's like saying that car without wheels and an engine is not broken. I mean: you can still pull it with enough horses attached thus move people and cargo, right? So it's still usable, kinda.</p>
<p>Similarly here: the only difference between pathname and filename is the fact that pathnames have hierarchy.</p>
<p>Sure, apps which don't need pathnames but are just happy to use them as opaque file identifiers in a flat namespace are not broken with symlinks. But <b>everything else</b> is broken is a sense that Joe Average Developer would write incorrect code 10 times out of 10.</p>
<p>How you can call this “not utterly broken” is beyond me.</p>
<font class=QuotedText>&gt; Most applications will not have to care whether there's a directory symlink in the path, even if Samba needs to do its own userspace chroot.</font>
<p>On the contrary: practically any app which deals with file hierarchies (and just with individual files) is broken. Not all such programs lead to security vulnerability because sometimes you have situation “Joe can break Joe's program which s/he can crash directly anyway” which is considered acceptable. But they are broken, nonetheless.</p>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900314/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900315></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 16:09 UTC (Thu) by <b>Sesse</b> (subscriber, #53779)
 [<a href=https://lwn.net/Articles/900315/>Link</a>]
 </p>
 <div class=FormattedComment>
I guess the disparity here is how many apps you think really needs to care. Most that I use certainly don't. File servers (including Apache) are a notable exception.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900315/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900399></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 8:57 UTC (Fri) by <b>gerdesj</b> (subscriber, #5446)
 [<a href=https://lwn.net/Articles/900399/>Link</a>]
 </p>
 <div class=FormattedComment>
"File servers (including Apache) are a notable exception."<br>
<p>
That's quite a large notable exception!<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900399/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900513></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 9, 2022 0:47 UTC (Sat) by <b>willy</b> (guest, #9762)
 [<a href=https://lwn.net/Articles/900513/>Link</a>]
 </p>
 <div class=FormattedComment>
If you're NetApp, sure. But if you consider desktop (or phone) usage of Linux, it's a small and uninteresting exception.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900513/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor902246></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 23, 2022 0:17 UTC (Sat) by <b>DimeCadmium</b> (guest, #157243)
 [<a href=https://lwn.net/Articles/902246/>Link</a>]
 </p>
 <div class=FormattedComment>
They're also already large projects in and of themselves. Handling symlinks is still ultimately a very minor portion of the code.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/902246/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
</div>
<a name=CommAnchor900328></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 17:01 UTC (Thu) by <b>adobriyan</b> (subscriber, #30858)
 [<a href=https://lwn.net/Articles/900328/>Link</a>]
 </p>
 <div class=FormattedComment>
<font class=QuotedText>&gt; But everything else is broken is a sense that Joe Average Developer would write incorrect code 10 times out of 10.</font><br>
<p>
What are the requirements for, say, non-broken text editor wrt symlinks?<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900328/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900412></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 13:00 UTC (Fri) by <b>ilammy</b> (subscriber, #145312)
 [<a href=https://lwn.net/Articles/900412/>Link</a>]
 </p>
 <div class=FormattedComment>
If you open a file in multiple tabs via multiple paths, edits in one of them should reflect in the other, immediately.<br>
<p>
If a symlink in the open path has changed while a file is being edited, users might or might not want to be notified about that instead of overwriting some other file.<br>
<p>
If there is a symlink loop, search by all files in the project should not hang or print out infinite results.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900412/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900413></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 13:05 UTC (Fri) by <b>Sesse</b> (subscriber, #53779)
 [<a href=https://lwn.net/Articles/900413/>Link</a>]
 </p>
 <div class=FormattedComment>
I find this example pretty contrived, but OK: stat() the file and check its inode number. (There's no new TOCTTOU, since editors typically don't keep the file descriptors open anyway.)<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900413/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor900496></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 20:24 UTC (Fri) by <b>nybble41</b> (subscriber, #55106)
 [<a href=https://lwn.net/Articles/900496/>Link</a>]
 </p>
 <div class=FormattedComment>
The first two cases would also be an issue with hard links. You can't assume that a different path means a different file. And all three are possible with bind mounts, network filesystems, FUSE filesystems, or removable devices without involving symlinks in any way, so you need to handle those cases properly whether or not symlinks are available. For example the third case could be addressed by checking the device and inode numbers for each directory to prevent recursion, and also setting an absolute limit on the depth of the search.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900496/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor900508></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 22:26 UTC (Fri) by <b>k8to</b> (subscriber, #15413)
 [<a href=https://lwn.net/Articles/900508/>Link</a>]
 </p>
 <div class=FormattedComment>
This is .. not standard text editor behavior.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900508/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
</div>
<a name=CommAnchor900333></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 17:54 UTC (Thu) by <b>jthill</b> (subscriber, #56558)
 [<a href=https://lwn.net/Articles/900333/>Link</a>]
 </p>
 Is the concept of user input utterly broken because little bobby tables is such a hellraiser? I don't think so, I don't see how pointing to all the CVEs for failure to scrub user input is any different than pointing to all the CVEs for failure to scrub paths.
<p>
Besides, open and fstat the path's final directory, if getuid() owns it you don't even have to vet whatever real path you'd need to get you there, then either you don't follow final symlinks or you iteratively re-vet what readlinkat() for them gets you; and if when you later decide to rewrite your hosts file the path it's going to isn't a previously-vetted device and inode you'd would be well within reason to just refuse to continue.
<p>
Instead of blackholing symlinks a quick little library to implement the operations in terms of those safety checks seems reasonable; things like ssh and samba for which those aren't a enough are distinctly not Joe Average Coder projects. `std::filesystem` should probably operate by default only with getuid()-owned files anyway.
 </p></div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900333/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900360></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 22:39 UTC (Thu) by <b>khim</b> (subscriber, #9252)
 [<a href=https://lwn.net/Articles/900360/>Link</a>]
 </p>
 <font class=QuotedText>&gt; Is the concept of user input utterly broken because little bobby tables is such a hellraiser?</font>
<p>The concept of injecting user input into a string is utterly broken, yes. That's why we have <a href=https://en.wikipedia.org/wiki/Prepared_statement>entirely different API</a> which solves that issue once and for all. We don't have anything similar for pathnames.</p>
<font class=QuotedText>&gt; Besides, open and fstat the path's final directory</font>
<p>Have you actually read the article? Even finding <i>the path's final directory</i> is quite non-trivial.</p>
<font class=QuotedText>&gt; Instead of blackholing symlinks a quick little library to implement the operations in terms of those safety checks seems reasonable</font>
<p>Make one. Give it to Jeremy and we can make a bet about how many ways it's broken.</p>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900360/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
</div>
<a name=CommAnchor900378></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 2:32 UTC (Fri) by <b>k8to</b> (subscriber, #15413)
 [<a href=https://lwn.net/Articles/900378/>Link</a>]
 </p>
 <div class=FormattedComment>
Very much this.<br>
<p>
99% of the time, you can just ignore them entirely as a developer and everything works.<br>
<p>
It's true that once developers start trying to care about symbolic links explicitly they often make many errors. Usually it's enough to just use libc's realpath and consider the final answer. Trying to care about symbolic links in more detail is usually a path to madness.<br>
<p>
For some problems, there are reasonable patterns, like writing code to "monitor" a directory and its contents, you usually don't want to follow links at all to avoid infinite loops etc, with limited user-provided exceptions.<br>
<p>
For other problems, there may not be a good solution. I haven't worked on any problems like that in my long programming career, however.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900378/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900307></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 15:48 UTC (Thu) by <b>iabervon</b> (subscriber, #722)
 [<a href=https://lwn.net/Articles/900307/>Link</a>]
 </p>
 <div class=FormattedComment>
I think it would make sense to have the kernel not follow symlinks when doing path-based operations in general, and have user space libraries, when doing things that should possibly be affected by symlinks, call realpath(), validate the result as appropriate for having just been given the path from a possibly-malicious source, and use the result, which will probably be a path that works without the kernel following symlinks (or will fail safely).<br>
<p>
I could imagine a C library change that would set the prctl and handle symlinks in user space with realpath() for the traditionally-named path-based functions, and include variants that you use instead if you're going to validate the path at all.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900307/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900316></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 16:11 UTC (Thu) by <b>khim</b> (subscriber, #9252)
 [<a href=https://lwn.net/Articles/900316/>Link</a>]
 </p>
 <p>This would have worked great if we had a time machine and had the ability to go back to 1991 or 1992 to change Linux API.</p>
<p>I don't think we have this option today.</p>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900316/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor900317></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 16:23 UTC (Thu) by <b>nix</b> (subscriber, #2304)
 [<a href=https://lwn.net/Articles/900317/>Link</a>]
 </p>
 <div class=FormattedComment>
That requires all userspace programs not only to follow symlinks but to do so recursively (since any component of a path may be a symlink), and to do so in a race-free fashion. They also all need to spot loops.<br>
<p>
How many of them do you imagine will get *that* right, given how many bugs and races there have been in, say, rm -rf, which you'd think is heavily tested? Oh look, a new set of security holes, probably worse than the last lot.<br>
<p>
 -- N., very heavy user of symlinks, thank god for Nix (the distro, no relation) making sure that not too many break when entire /usr trees are symlink farms<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900317/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900337></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 17:38 UTC (Thu) by <b>pbonzini</b> (subscriber, #60935)
 [<a href=https://lwn.net/Articles/900337/>Link</a>]
 </p>
 <div class=FormattedComment>
At least in theory libc could be doing all that. However it would also be much slower and wasteful, because all the caching that the kernel does would be split across multiple userspace programs, and the cache would start cold for every new process.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900337/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor907051></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Sep 3, 2022 11:56 UTC (Sat) by <b>nix</b> (subscriber, #2304)
 [<a href=https://lwn.net/Articles/907051/>Link</a>]
 </p>
 <div class=FormattedComment>
In theory libc could implement its own cross-process cache using shared memory, like nscd. In practice, the mere thought is painful. This is definitely not userspace's job :)<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/907051/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900334></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 19:33 UTC (Thu) by <b>iabervon</b> (subscriber, #722)
 [<a href=https://lwn.net/Articles/900334/>Link</a>]
 </p>
 <div class=FormattedComment>
I imagine that either all userspace programs will get recursively following symlinks right, or they'll all get it wrong, since I think it would be done in libc and they'd all use the same implementation. For that matter, I think the implementation should probably be a system call that takes a path that may use symlinks and returns a path that doesn't use symlinks, in which case everyone would end up using the correct implementation that the kernel uses.<br>
<p>
The only change I can see to outcomes of path-based operations from having separate resolve and operate syscalls would be that, if you rename a symlink over a regular file, a poorly-timed open() could get ELOOP instead of either getting the original file or the target of the symlink. Replacing one symlink with another would be atomic, and any other operation isn't atomic today (that is, you can't replace a directory with a symlink atomically, and you can't replace both a symlink and another file atomically; I guess you might get ELOOP when you could only have gotten ENOENT).<br>
<p>
As far as changes to userspace program code, the only one would be that, if you've explicitly called realpath() yourself and validated the result in some way, you'd call realopen() on the string you validated rather than calling open() and getting another round of symlink resolution that might be different.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900334/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900340></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 18:56 UTC (Thu) by <b>bartoc</b> (subscriber, #124262)
 [<a href=https://lwn.net/Articles/900340/>Link</a>]
 </p>
 <div class=FormattedComment>
this is a bad idea. You want to be able to use symlinks to point an unsuspecting application somewhere else. The trouble comes when the unsuspecting app has a higher privilege level than the symlink creator.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900340/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900336></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 17:40 UTC (Thu) by <b>sbaugh</b> (guest, #103291)
 [<a href=https://lwn.net/Articles/900336/>Link</a>]
 </p>
 <div class=FormattedComment>
Plan 9 doesn't have symlinks. Their alternative is bind mounts, which can be created without privileges in Plan 9 since every process runs in its own private mount namespace, which seems like a much better approach. See e.g. <a href=https://9p.io/sys/doc/lexnames.html>https://9p.io/sys/doc/lexnames.html</a><br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900336/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900348></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 20:09 UTC (Thu) by <b>wahern</b> (subscriber, #37304)
 [<a href=https://lwn.net/Articles/900348/>Link</a>]
 </p>
 <div class=FormattedComment>
If we apply the same premises by which symlinks are judged insecure, user bind mounts are in many respects even *more* insecure. OTOH, such systems tend to disabuse you of those flawed premises, particularly the premise that a path name says anything of substance about authorization.<br>
<p>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900348/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900354></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 21:33 UTC (Thu) by <b>neilbrown</b> (subscriber, #359)
 [<a href=https://lwn.net/Articles/900354/>Link</a>]
 </p>
 <div class=FormattedComment>
<font class=QuotedText>&gt; If we apply the same premises by which symlinks are judged insecure, user bind mounts are in many respects even *more* insecure.</font><br>
<p>
But it isn't just bind mounts, it is bind mounts in a private namespace. I don't think they are insecure.<br>
<p>
The insecurity of symlinks is that if I create a symlink you have to follow it. When I create a bind mount in a private namespace you can't even see it let alone follow it <br>
<p>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900354/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900356></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 22:15 UTC (Thu) by <b>willy</b> (guest, #9762)
 [<a href=https://lwn.net/Articles/900356/>Link</a>]
 </p>
 <div class=FormattedComment>
They're not insecure in the context of plan9. They're horrendously insecure in Unix with our setuid executables.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900356/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900362></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 22:43 UTC (Thu) by <b>khim</b> (subscriber, #9252)
 [<a href=https://lwn.net/Articles/900362/>Link</a>]
 </p>
 <p>It all comes down to the original sin: the ability of less-privileged programs to dictate the worldview of more privileged programs.</p>
<p>This is fixable (Android, macOS, Windows, some Linux distributions are trying to fix that) but I wonder how much time would it take. Years? Decades?</p>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900362/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor904014></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Aug 5, 2022 16:11 UTC (Fri) by <b>immibis</b> (subscriber, #105511)
 [<a href=https://lwn.net/Articles/904014/>Link</a>]
 </p>
 <div class=FormattedComment>
Oftentimes the privileged program is expected to follow the symbolic link - what then?<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/904014/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900358></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 22:58 UTC (Thu) by <b>Hello71</b> (guest, #103412)
 [<a href=https://lwn.net/Articles/900358/>Link</a>]
 </p>
 <div class=FormattedComment>
i'm more inclined to agree with the proposition advanced by e.g. Rich Felker that actually suid executables are profoundly broken. privilege escalation should occur via communication with a system daemon using a well-defined protocol, not a partially-privileged process with ad-hoc environment inheritance rules. executing a suid program resets (at least) two prctl flags; without looking at the manual, which ones? actually, i'm not sure there's anything theoretically preventing adding mount namespaces to the long list of reset-on-suid-exe states.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900358/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900384></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 5:13 UTC (Fri) by <b>matthias</b> (subscriber, #94967)
 [<a href=https://lwn.net/Articles/900384/>Link</a>]
 </p>
 <div class=FormattedComment>
<font class=QuotedText>&gt; actually, i'm not sure there's anything theoretically preventing adding mount namespaces to the long list of reset-on-suid-exe states.</font><br>
<p>
Are you suggesting that if someone calls a suid binary inside a container, the binary should not use the mount namespace of the container but the root mount namespace instead?<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900384/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor900391></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 6:35 UTC (Fri) by <b>neilbrown</b> (subscriber, #359)
 [<a href=https://lwn.net/Articles/900391/>Link</a>]
 </p>
 <div class=FormattedComment>
<font class=QuotedText>&gt; suid executables are profoundly broken</font><br>
<p>
That's exactly the point I was going to make. bind mounts in private namespaces are perfectly safe. setuid programs as profoundly broken, whether you use namespaces or not.<br>
If we, collectively, were serious about security, we would be mounting all filesystems with nosuid.<br>
<p>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900391/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor900403></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 10:16 UTC (Fri) by <b>tialaramex</b> (subscriber, #21167)
 [<a href=https://lwn.net/Articles/900403/>Link</a>]
 </p>
 <div class=FormattedComment>
"SUID is profoundly broken" I find a lot easier to get behind than "symbolic links are the problem".<br>
<p>
One of the things I appreciate in Rust is that where there are special cases somebody takes the time to think about whether in fact there's some more general principle of which the special case was just the easy to observe part, the tip of the iceberg so to say, and to provide for the general principle, rather than just the special case.<br>
<p>
Example: If you're a Rust beginner you learn that Option's None and Result's Error can be passed back up to your caller where appropriate with the '?' try operator and this seems like a special case, you can't go around treating an integer, or a file handle, or some other kind of thing this way. Or can you? In fact the general principle is the (nightly gated) Try trait, and Option and Result merely implement Try (they're allowed to do this even in stable Rust because Rust internally isn't subject to its own stability rules or it'd be recursively impossible to develop anything)<br>
<p>
Another example: In languages with ad hoc polymorphism ("Function overloading") it's obvious that "LWN.net".contains("LWN") and "LWN.net".contains('.') are both reasonable things to write so you just overload the function to do either. Rust doesn't have ad hoc polymorphism, so it must decide what type that parameter is such that both "LWN" and '.' match or else provide two functions with different names. The resulting trait Pattern once again represents a more general principle - any pattern which could match parts of a string, and so in Rust you can also write "LWN.net".contains(char::is_alphabetic) because hey, char::is_alphabetic is a function which matches parts of a string so why not.<br>
<p>
I think SUID just isn't one of those things, it's a profoundly special case, and so we should immediately be prejudiced against it as a design feature of the operating system. Rather than everything just falling out naturally, as we'd like for a general solution, SUID means everywhere we need to handle this differently. If you've just written a bunch of low level code there's a good chance that if I remind you that SUID exists you'll need to go back and add a bunch of conditional branches to handle that...<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900403/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900408></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 11:25 UTC (Fri) by <b>farnz</b> (subscriber, #17727)
 [<a href=https://lwn.net/Articles/900408/>Link</a>]
 </p>
 <p>Another reason to be biased against SUID is that it's a quick solution to the problem of users not having root access to the entire machine.
<p>There are three different ways to run something as root on a Linux-like system (assuming that you've got an ordinary user account):
<ol>
<li>Get someone to log in as root and run the command directly for you.
<li>Send a message over a suitable transport to something that runs the process for you - <tt>AF_UNIX</tt> sockets, SSH to localhost or similar, authenticating you and deciding whether you can do that.
<li>Get someone to make the command SUID and run it yourself.
</ol>
<p>The first is a non-starter if you're not trusted with root yourself - the coordination to keep someone with root access around is a pain.
<p>The second involves more code. You have to have something running that can make the policy decisions based on a string sent to it, and then execute the process for you. There's also complexity around transferring "enough" environment state to the privileged process, and transferring results back.
<p>The third is easy. Most of your SUID process's state is the same as it would have if it wasn't SUID, except for a few "minor" bits here and there (and this list of things is growing as we find security holes that cannot be fixed except by resetting state).
<p>Ideally, everyone would bother to do the second option for things that need to be privileged - but that's a lot of work, and SUID is a "neat hack" that means you don't need to do it.
 </p></div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900408/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900575></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 9, 2022 20:19 UTC (Sat) by <b>NYKevin</b> (subscriber, #129325)
 [<a href=https://lwn.net/Articles/900575/>Link</a>]
 </p>
 <div class=FormattedComment>
The thing is, between systemd and polkit, option 2 is far easier now than it has ever been in the past. I think we are pretty much at the point where suid could just be outright deprecated and it wouldn't be that big of a deal. The anti-systemd crowd would not like that, of course, but what else is new?<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900575/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
</div>
<a name=CommAnchor900411></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 12:32 UTC (Fri) by <b>hallyn</b> (subscriber, #22558)
 [<a href=https://lwn.net/Articles/900411/>Link</a>]
 </p>
 <div class=FormattedComment>
<font class=QuotedText>&gt; actually, i'm not sure there's anything theoretically preventing adding mount namespaces to the long list of reset-on-suid-exe states</font><br>
<p>
User namespaces are designed such that this is supposed to not be necessary: you can only mount things if you create a new user namespace, and if you are fully unprivileged, you can only map ns-root to your own or a delegated uid, so you cannot trick host root with bind mounts and a setuid-root binary. The problem with user namespaces comes because user namespaces also want to grant ns-root privilege over the resources owned by the creator. And they do that pretty well, it's just that that expands the amount of kernel code which an unprivileged user can exercise, and exploit.<br>
<p>
<font class=QuotedText>&gt; privilege escalation should occur via communication with a system daemon using a well-defined protocol</font><br>
<p>
Several people have tried to the plumbing needed for plan-9 factotum functionality into the kernel. My last attempt (expanding on Ashwin Ganti's original code) was 10 years ago - <a href=https://lore.kernel.org/all/20100427164139.GA7359@us.ibm.com/>https://lore.kernel.org/all/20100427164139.GA7359@us.ibm....</a> , and there was a more recent independent patch posted at <a href=https://lore.kernel.org/all/20180210165845.18852-1-metux@gmx.de/>https://lore.kernel.org/all/20180210165845.18852-1-metux@...</a> .<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900411/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900816></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 12, 2022 8:10 UTC (Tue) by <b>koverstreet</b> (subscriber, #4296)
 [<a href=https://lwn.net/Articles/900816/>Link</a>]
 </p>
 <div class=FormattedComment>
It's not just suid executables, it's any time you're using the filesystem across a permissions boundary - any time you have one program walking/reading/writing filesystem paths controlled by another user.<br>
<p>
Which is pretty huge.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900816/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
</div>
</div>
</div>
<a name=CommAnchor900350></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 20:27 UTC (Thu) by <b>developer122</b> (subscriber, #152928)
 [<a href=https://lwn.net/Articles/900350/>Link</a>]
 </p>
 <div class=FormattedComment>
Could this have been avoided if creating a symlink required permissions in both the source and destination directories?<br>
<p>
(I suppose this would require a filesystem to be checked and it's symlinks validated/invalidated during mounting)<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900350/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900364></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 22:55 UTC (Thu) by <b>Hello71</b> (guest, #103412)
 [<a href=https://lwn.net/Articles/900364/>Link</a>]
 </p>
 <div class=FormattedComment>
sure, but also the permissions on the destination and all of its parents can never be changed during the lifetime of the link, implying that for each file and directory, either a list of all links to it and its children must be stored, or whenever its permission is changed, the whole filesystem must be walked.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900364/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900400></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 9:01 UTC (Fri) by <b>taladar</b> (subscriber, #68407)
 [<a href=https://lwn.net/Articles/900400/>Link</a>]
 </p>
 <div class=FormattedComment>
Not necessarily. Technically it would be enough to keep a reference counter and only allow permission changes when it is 0. The issue with that would be that it could go out of sync with the actual number of links pointing to the directory in certain situations but that is the same with the list.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900400/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor900504></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 21:12 UTC (Fri) by <b>developer122</b> (subscriber, #152928)
 [<a href=https://lwn.net/Articles/900504/>Link</a>]
 </p>
 <div class=FormattedComment>
That doesn't actually sound like a problem.<br>
<p>
If you're giving someone permission to make a simlink in a folder, then why care about any of it's parents? How is it different than regular wread/write access to the folder? (you'd be able to make/change files there anyway) Wouldn't altering/removing a parent break the simlink during lookup?<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900504/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900509></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 23:12 UTC (Fri) by <b>developer122</b> (subscriber, #152928)
 [<a href=https://lwn.net/Articles/900509/>Link</a>]
 </p>
 <div class=FormattedComment>
Thinking about it some more, I suppose you could change the ownership of the containing folder, create *another* symlink to it, and then optionally change the ownership back. Then the file is effectively double-mapped. There might be some way around this by checking the ownership at runtime or some other extra checks or reference counters, but it definitely needs to be considered carefully.<br>
<p>
I still don't see what the issue is with altering parent directories of the folder in question though, or what special capability symlinks add to that scenario.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900509/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
</div>
</div>
<a name=CommAnchor900357></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 22:51 UTC (Thu) by <b>zaitseff</b> (subscriber, #851)
 [<a href=https://lwn.net/Articles/900357/>Link</a>]
 </p>
 <p>As Chris points out, the problem is <em>not</em> so much symlinks as Time Of Check to Time of Use (TOCTOU). Take, for example, a problem I've faced writing a simple C program:</p>
<ol>
 <li>I want my program to read and store user data/configuration.</li>
 <li>The traditional place for that data (over the thirty years of the program so far) has been <i>~/.PROGRAM</i>.</li>
 <li>Modern XDG systems use <i>~/.local/share</i> for such purposes (actually, possibly using <tt>XDG_DATA_HOME</tt> from the environment).</li>
 <li>I'd like my program to continue to use <i>~/.PROGRAM</i> if it already exists, otherwise use <i>${XDG_DATA_HOME}/PROGRAM</i> if $XDG_DATA_HOME is set (creating the directory, and any parents as required, if it doesn't exist), otherwise use <i>~/.local/share/PROGRAM</i> (creating the directory, and any parents as required, if it doesn't exist).</li>
</ol>
<p>The naïve way would be to code up something like the following pseudo-C for determining which directory to use:</p>
<pre>    const char *traditional_path = "/home/john/.PROGRAM";    /* Just for testing */
    const char *xdg_default_path = "/home/john/.local/share/PROGRAM";
    const char *xdg_data_home = getenv("XDG_DATA_HOME");
    char *xdg_path;

    if (stat(traditional_path, &amp;statbuf) == 0 &amp;&amp; S_ISDIR(statbuf.st_mode)) {
        return traditional_path;
    } else if (xdg_data_home != NULL &amp;&amp; *xdg_data_home != '\0' &amp;&amp; *xdg_data_home == '/') {
        /* Use xdg_data_home + "/PROGRAM"; */
        xdg_path = strcat_malloc(xdg_data_home, "/PROGRAM");
        return xdg_path;
    } else {
        return xdg_default_path;
    }
</pre>
<p>And there you have it: a TOCTOU error (check for <i>/home/john/.trader</i> before creating the final target path using <tt>mkdir()</tt> later). No symlinks need be involved.</p>
<p>Now you can merrily post <em>your</em> solution to the above problem! <tt>:-)</tt></p>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900357/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900367></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 23:04 UTC (Thu) by <b>Paf</b> (subscriber, #91811)
 [<a href=https://lwn.net/Articles/900367/>Link</a>]
 </p>
 <div class=FormattedComment>
For a preferences file, I wouldn’t solve it. ;)<br>
<p>
Now for something else which was security critical …………….. eek<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900367/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor900366></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 23:06 UTC (Thu) by <b>zaitseff</b> (subscriber, #851)
 [<a href=https://lwn.net/Articles/900366/>Link</a>]
 </p>
 <div class=FormattedComment>
And I should mention that, as an additional wrinkle/challenge, any solution must be portable to the latest versions of FreeBSD, OpenBSD, NetBSD, macOS, Solaris, ... — any POSIX environment.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900366/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900371></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 7, 2022 23:57 UTC (Thu) by <b>mpr22</b> (subscriber, #60784)
 [<a href=https://lwn.net/Articles/900371/>Link</a>]
 </p>
 <div class=FormattedComment>
It's worth noting that openat(), mkdirat(), and fdopendir() were adopted in POSIX.1-2008.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900371/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900373></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 0:46 UTC (Fri) by <b>zaitseff</b> (subscriber, #851)
 [<a href=https://lwn.net/Articles/900373/>Link</a>]
 </p>
 <p>Indeed. However, I can't quite see how to use these: something I didn't mention is that <tt>mkdir()</tt> is only run if writing a data file: if no data file is saved (a user-initiated operation), no directory is created. So I'm not sure how to avoid the TOCTOU problem in such a situation.</p>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900373/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900374></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 1:20 UTC (Fri) by <b>mpr22</b> (subscriber, #60784)
 [<a href=https://lwn.net/Articles/900374/>Link</a>]
 </p>
 <ol>
<li>Any time you access a file without knowing which data directory to use, search for your preferred data directory with open() and fstat().</li>
<li>If you find one of your desired directories, retain the file descriptor as well as the pathname, and use openat() with the file descriptor for all further activities relating to your preferred data directory.</li>
<li>If you don't find <em>any</em> of the desired data directories, then don't retain the result at all; next time you try to access a file, start fresh from step 1.</li>
</ol>
<p>Safely creating the directory if it doesn't exist is still kind of a pain in the neck, because you can't combine the operations of "make a directory" and "open a file descriptor pointing to the directory" into a single indivisible syscall.</p>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900374/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900382></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 4:16 UTC (Fri) by <b>magfr</b> (subscriber, #16052)
 [<a href=https://lwn.net/Articles/900382/>Link</a>]
 </p>
 <div class=FormattedComment>
And neither the cd nor the mkdir shell builtin provides a flag to create a directory and chdir to it in one operation.<br>
Probably for that exact reason but I have wished for it at times.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900382/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
</div>
</div>
</div>
<a name=CommAnchor900379></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 2:39 UTC (Fri) by <b>k8to</b> (subscriber, #15413)
 [<a href=https://lwn.net/Articles/900379/>Link</a>]
 </p>
 <div class=FormattedComment>
I mean the usual solution for something along these lines is not to pass a computed path for later opening but rather open the file and pass that.<br>
<p>
But if you want to have a problem have a stable dir it settles on and uses consistently, you've kind of designed a TOCTOU problem into the concept of your program or library. At least with classic system calls.<br>
<p>
Of course *at calls allow one to do precisely what I implied. Open the dir, and keep it around for use. With pipe magic you can even eliminate TOCTOU across multiple processes.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900379/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900377></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 2:21 UTC (Fri) by <b>felixfix</b> (subscriber, #242)
 [<a href=https://lwn.net/Articles/900377/>Link</a>]
 </p>
 <div class=FormattedComment>
"Symlinks were created, Allison theorized, because hard links are restricted to linking within the same filesystem"<br>
<p>
Hard links are also restricted to regular files, or at least to not being a directory. I checked just now, and almost all my symlinks are to directories.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900377/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900397></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 8:36 UTC (Fri) by <b>nim-nim</b> (subscriber, #34454)
 [<a href=https://lwn.net/Articles/900397/>Link</a>]
 </p>
 <div class=FormattedComment>
Yes a lot of those exist because people can’t agree on the correct file layout, app writers adhere to different theories, so the only way to make a bunch of unix apps behave more or less the same (becoming manageable) is to fool them via symlinks.<br>
<p>
Windows uses magic registry entries for the same need, it works about as ugly.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900397/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900406></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 10:28 UTC (Fri) by <b>grawity</b> (subscriber, #80596)
 [<a href=https://lwn.net/Articles/900406/>Link</a>]
 </p>
 <p>Even Windows (after the Vista migration to space-less directories) now ships with symlinks like <code>~\Application Data</code> to <code>~\AppData\Roaming</code>, because programs can't be bothered to check environment and just hardcode paths...</p>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900406/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor902147></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 22, 2022 7:40 UTC (Fri) by <b>callegar</b> (guest, #16148)
 [<a href=https://lwn.net/Articles/902147/>Link</a>]
 </p>
 Hard links are also way more "symmetric" and the inherent "asymmetry" in symbolic links has value and usage.
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/902147/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900395></a>
<div class=CommentBox>
 <h3 class=CommentTitle>another level of indirection</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 8, 2022 7:51 UTC (Fri) by <b>rgb</b> (subscriber, #57129)
 [<a href=https://lwn.net/Articles/900395/>Link</a>]
 </p>
 <div class=FormattedComment>
You could probably make the same argument about almost any kernel feature: virtual memory, name spaces, virtual filesystem, snapshots, ...<br>
“All problems in computer science can be solved by another level of indirection." And each level of indirection creates another level of pain.<br>
The alternative would be to still run on the bare metal writing assembly I guess.<br>
<p>
<p>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900395/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor900512></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 9, 2022 0:27 UTC (Sat) by <b>pj</b> (subscriber, #4506)
 [<a href=https://lwn.net/Articles/900512/>Link</a>]
 </p>
 <div class=FormattedComment>
Gnu Stow is the least of the users... consider NixOS, Nix and Guix.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900512/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor900518></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 9, 2022 3:31 UTC (Sat) by <b>Subsentient</b> (subscriber, #142918)
 [<a href=https://lwn.net/Articles/900518/>Link</a>]
 </p>
 <div class=FormattedComment>
I *love* symlinks as they are, and I use them constantly, but the author makes some good points, especially with the race condition. This should all be fixable with new system calls/libc functions. Please don't mess with symlinks in general.<br>
<p>
I personally don't *want* most userspace programs to be able to tell if something is a link. I've much more often had issues with a program that saw a symlink and refused to dereference it, than I ever have with a program that used them implicitly.<br>
<p>
Note to other userspace developers: Please use stat() instead of lstat() whenever possible. You don't know if there's a good reason it's a symlink, for example, a .config folder could be pointing into an sshfs network drive so my settings are synced between machines. I put symlinks in weird places if I think they're useful, and the only times it hurts me are when some application is using lstat() and/or looking for symlinks some other way.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900518/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900532></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 9, 2022 11:55 UTC (Sat) by <b>mathstuf</b> (subscriber, #69389)
 [<a href=https://lwn.net/Articles/900532/>Link</a>]
 </p>
 <div class=FormattedComment>
<font class=QuotedText>&gt; Please use stat() instead of lstat() whenever possible.</font><br>
<p>
One place you can't is when asking "does this path exist?" because `stat` will return "no" for broken (or looped) symlinks while `lstat` will say "yes".<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900532/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900750></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 11, 2022 20:00 UTC (Mon) by <b>ma4ris5</b> (subscriber, #151140)
 [<a href=https://lwn.net/Articles/900750/>Link</a>]
 </p>
 <div class=FormattedComment>
<p>
Here is one conceptual way to _open up a file for read_ in a safe way<br>
<p>
It is possible to validate a path with file descriptors,<br>
using openat() family of functions, to open folders starting from root into the actual file,<br>
and then _from the directory_, that contains the file, back to root folder with ".." traversal.<br>
The inode numbers should match this validation.<br>
<p>
"_from the directory_" can be checked this way:<br>
Somehow discover the folder that contains the non-soft linked file.<br>
Both directory and file must be fd-opened, and directory must contain that non-soft link file.<br>
<p>
"_from the directory_" physical path can be discovered in a way "pwd -P" does it:<br>
Fork, forked program must set working directory as the directory fd.<br>
Then forked program can read /proc/self/cwd and print it for the caller process.<br>
<p>
There are some other details that must be taken care too (signal handling, unrelated file descriptors),<br>
to make fork work robustly, but that is out of scope for now.<br>
<p>
For opening file for write can be done with the above elements too: grab a validated folder,<br>
open non-soft linked file there.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900750/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900797></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 12, 2022 3:26 UTC (Tue) by <b>neilbrown</b> (subscriber, #359)
 [<a href=https://lwn.net/Articles/900797/>Link</a>]
 </p>
 <div class=FormattedComment>
<font class=QuotedText>&gt; Here is one conceptual way to _open up a file for read_ in a safe way</font><br>
<p>
Or you could use realpath() to expand all the symlinks, validate the path in whatever way you care about, and then use openat2() with RESOLVE_NO_SYMLINKS.<br>
If any symlinks have been inserted into the path, the open will fail.<br>
<p>
(requires Linux 5.6 or later, glibc doesn't have a wrapper)<br>
<p>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900797/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor901325></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 15, 2022 6:10 UTC (Fri) by <b>ma4ris5</b> (subscriber, #151140)
 [<a href=https://lwn.net/Articles/901325/>Link</a>]
 </p>
 <div class=FormattedComment>
Thanks for the tip. Sounds sane: First remove symbolic links, then expect that there are no symbolic links.<br>
<p>
With all uncertainty, the approach that I mentioned, is to first hold file descriptor to something<br>
that is nearest of the goal operation.<br>
File descriptor is stable (Kernel guarantees that), so holding it prevents many kinds of race conditions.<br>
Then validate the opened file descriptor based on trusted sources for security reasons.<br>
<p>
After gaining trust for a folder file descriptor, use it in safe ways (for example create a file with symbolic links turned off).<br>
<p>
So from Samba developer, /proc/self approach works for solving the real path for validation:<br>
<p>
fd = openat(-1, "/bin", O_DIRECTORY); /* fd = 3 */<br>
resolved_path = realpath("/proc/self/fd/3", NULL); /* resolved_path="/usr/bin" */<br>
<p>
"/usr/bin" is safe, so fd 3 can be used for following operations.<br>
<p>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901325/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
</div>
<a name=CommAnchor900821></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 12, 2022 8:33 UTC (Tue) by <b>koverstreet</b> (subscriber, #4296)
 [<a href=https://lwn.net/Articles/900821/>Link</a>]
 </p>
 <div class=FormattedComment>
Perhaps we should add a mount option to disable following symlinks that are<br>
 - not owned by the current user<br>
 - not owned by the root user<br>
 - that point to a different uid/gid as the symlink<br>
<p>
Are there any attacks that would miss?<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900821/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor900832></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 12, 2022 12:30 UTC (Tue) by <b>jengelh</b> (subscriber, #33263)
 [<a href=https://lwn.net/Articles/900832/>Link</a>]
 </p>
 <div class=FormattedComment>
A feature like that has existed for a long time in grsec as a build-time option. Found a mirror at e.g. <a href=https://github.com/hannob/symlinkown>https://github.com/hannob/symlinkown</a> .<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900832/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor900947></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 12, 2022 20:50 UTC (Tue) by <b>civodul</b> (guest, #58311)
 [<a href=https://lwn.net/Articles/900947/>Link</a>]
 </p>
 <div class=FormattedComment>
I view the *at function family as the right thing; it was wrong for 'open' et al. to take an implicit "root" parameter (the Hurd file system interface is very much like that: every file system operation takes a capability to the root directory on which it operates, starting with 'file_name_lookup', which is like 'openat').<br>
<p>
In some cases, such as the Stow/Guix/Nix examples, symlinks could be replaced by a unionfs. Maybe a way forward?<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/900947/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor907470></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Sep 8, 2022 12:32 UTC (Thu) by <b>nix</b> (subscriber, #2304)
 [<a href=https://lwn.net/Articles/907470/>Link</a>]
 </p>
 <div class=FormattedComment>
A unionfs of thousands of filesystems is going to be hilariously slow. You're replacing an O(smallnum) lookup when a symlink is resolved with an O(n) where n == number of installed packages for *every file lookup*, as it works through all the layers.<br>
<p>
Or did you mean to suggest some other, cleverer trick that I hadn't thought of? (Quite likely, because the naive approach is obviously a disaster.)<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/907470/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor901328></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 15, 2022 4:51 UTC (Fri) by <b>flussence</b> (subscriber, #85566)
 [<a href=https://lwn.net/Articles/901328/>Link</a>]
 </p>
 <div class=FormattedComment>
There's a whole lot of ways to avoid symlinks already in widespread use: ld.so.conf, xdg and similar ad-hoc patterns of spreading config all over the filesystem (/usr/share, /etc, /lib), $PATH… this looks like an area that, for lack of any one well-thought-out answer, gets reinvented equally poorly by nearly everything. Symlinks are indeed a nightmare but taking them away would probably result in more of these.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901328/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor901331></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 15, 2022 6:54 UTC (Fri) by <b>sven_wagner</b> (guest, #114232)
 [<a href=https://lwn.net/Articles/901331/>Link</a>]
 </p>
 <div class=FormattedComment>
For security, symlinks pose no "direct" problem, they are simple "look there instead" pointers that comes from a user thus is user provided data, should be input-validated when used and also resides in user space only.<br>
<p>
The problem starts when higher privileged accounts use user data to do tasks with higher privileges. I.e. when an admin is archiving (or restoring) user homes, syncing them from one Server to another (i.e. rsync).<br>
Or when a build-process (in one user account) uses another users data tree to act on it.<br>
Then TOCTOU becomes interesting.<br>
<p>
A few possible solutions:<br>
<p>
In nearly all cases (i believe) either the root job/cronjob should have been run under lesser privileges or should have been splitted into two phases like:<br>
- archive/restore only the user home folders (/home/*) but NOT their contents as at that directory level root privileges are needed to create the folders with their owners/permissions and <br>
- use separated archives per home folder and archive/restore them from within user space (sudo -u $user tar -xf $archive)<br>
<p>
Then the root task would not need symlink checking of user input as the restore task runs with user permissions only.<br>
<p>
The build process for example should not be able to write it's own config/scripts, so that a toctou attack could only alter the data actually used for the build which could be checked after a recursive copy into the build-process user space.<br>
<p>
Another way to prevent TOCTOU when reading (as root) user provided data (that resides in symlinks) would be to use immutable flag on the directories in the tree during the root task. The user himself cannot set the flag, so the admin already knows when this flag is set somewhere (and needs to stay) or otherwise can set it blindly and just remove it afterwards. Symlinks cannot be set immutable, but setting the directory immutable removes the users ability to remove or alter the symlinks or directories there, so after setting immutable flags to directories in user tree, the admin can once recheck, that all directories have the flag and then has no TOCTOU problems with directory/symlink changes until he removes the flags again after finishing the task. Maybe the user could still use fuse to overmount directories in is space, but the thread is about symlinks. (To prevent collusion with user scripts or cronjobs, flock could help)<br>
<p>
Using chroot could also be used to solve the "overwriting /etc/passwd" risk.<br>
<p>
Yet another way:<br>
SElinux provides a way to allow a script to have root privileges (as in setting the owner of arbritary files) while by design it needs a "whitelist" which group of files /dirs (sockets .. etc) it is allowed to modify (and how exactly), before it can do so. A process that can write to home_t or samba_share_t (which i assume often needs chown privileges) would not be able to write to etc_t. Instead of getting tricked by the user with changing symlinks to write to /etc/passwd it would create an audit record of this attack vector for beeing used (and prevented).<br>
On the other hand, the cronjob that runs as root would also not need to read shadow_t and (as it is not whitelisted) could also not leak data on beeing tricked by TOCTOU attacks.<br>
<p>
Symlinks are not a problem here, administration with only(!) multi-decades old security mechanisms, actually is. There is a reason for SELinux to exist and there are hundreds (or more) of reasons to use it. =)<br>
Other than by preventing symbolic links from beeing used to trick some other process by entirely removing the whole symlink mechanism, selinux prevents all not whitelisted accesses on a syscall level AND also reports the already prevented attack.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901331/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor901352></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 15, 2022 10:57 UTC (Fri) by <b>ma4ris5</b> (subscriber, #151140)
 [<a href=https://lwn.net/Articles/901352/>Link</a>]
 </p>
 <div class=FormattedComment>
<p>
I remember when I started studying at "Helsinki University of Technology (HUT)" in 1992.<br>
It is named now as "Aalto University", this is different from "University of Helsinki", where Linus studied.<br>
<p>
There were VT computer terminals with UART serial ports, attached to Unix desktops for shared<br>
use with private home folders on NFS. I remember learning Gopher, and also Mosaic browser:<br>
Maybe it was an early version of Mosaic - according to Wikipedia first release was at 1993.<br>
<p>
IT administrators told, that Unix vendors had fixed the TOCTTOU soft link race conditions:<br>
Some students in universities were using soft links in /tmp/ folders to gain root access before the fixes.<br>
Unix administrators in HUT forbid to try such attacks on the computers: attempts would be noticed and there were severe consequences.<br>
<p>
Fortunately symbolic link races were history: students were safe, and we learned to prevent the race conditions in the future.<br>
<p>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901352/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor901474></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 15, 2022 22:19 UTC (Fri) by <b>ma4ris5</b> (subscriber, #151140)
 [<a href=https://lwn.net/Articles/901474/>Link</a>]
 </p>
 <div class=FormattedComment>
So maybe the mistake was already made in 1992:<br>
TOCTTOU races were (partially) fixed, for the remaining ones,<br>
there was logging and software level booby traps.<br>
<p>
If somebody would try to search for the remaining race conditions,<br>
alerts would be raised for one of the first attempts,<br>
and user would be thrown out and blocked.<br>
<p>
IT departments were in control again.<br>
<p>
The world would look quite different in Linux side, if universities would have demanded<br>
for Unixes to remove soft link TOCTTOU races at file system level before 1992.<br>
<p>
Something like this might happen in next 10 years:<br>
<p>
Security scanners<br>
- open(), chmod() chcon() stat() etc. TOCTTOU hazard libc functions will be marked as insecure at source code level.<br>
- All applications that use those functions, will need to be altered (just like Samba multi year project to fix one CVE),<br>
 to avoid unsafe calls, otherwise those projects will become obsolete.<br>
- All commands, that have in source code such calls (like "setfacl -R" command which was mentioned in the Samba video )<br>
 are marked as vulnerable because of the possibility of existing TOCTTOU races.<br>
- Security aware application container deployments must use latest OS, because older OS versions don't get the (massive multi year) fixes.<br>
- Container (non-root-path) mounts that use data disks that follow soft links by default will be marked as insecure.<br>
<p>
Other attack mitigations<br>
- Of course, SELinux might come into containers too as mandatory, when OS is present at file system level.<br>
- Single binary containers take more ground (Examples: Rust, Go).<br>
 There is only host kernel, read only binary, configuration and root disk, data partition with no<br>
 soft link support, no vulnerable OS binaries at file system (only minimal set like "/work/", "/dev/", "/proc" and "/sys")).<br>
 No suid binaries. Container runs as non-root user.<br>
<p>
Converting all existing code bases into safety should be as easy as possible (the 10 year project).<br>
Creating new safe applications should be the easy (default) way. Creating vulnerable code is fine to be a bit harder to do.<br>
<p>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901474/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor901501></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 16, 2022 8:08 UTC (Sat) by <b>sven_wagner</b> (guest, #114232)
 [<a href=https://lwn.net/Articles/901501/>Link</a>]
 </p>
 <div class=FormattedComment>
Yet a few more ways to secure working on user space data:<br>
<p>
Before starting the job, move the complete user space folder into another one where the user cannot reach it, check for still open file handles of the user, then do your job without fear of toctou by evil users and at the end move the folder back in place where the user can work on it.<br>
<p>
Another opportunity would be to temporarily remove login of the user, sigstop all of his processes and disable his cron/at jobs, let the privileged task be done and afterwards sigcont the processes again.<br>
<p>
Similar for shares, disable the user, check no currect connection is alive, do the job and enable the user again. Or just completely shutdown samba while the higher privileged job runs.<br>
<p>
Those who wants the user to be able to work while the higher privileged job is ongoing, would just add more insecurities that reside within the programs that work on the files but don't expect the file to be changed while reading or maybe even mmapping it. At least whatever the higher privileged task does with the data, cannot be assumed to be consistent.<br>
<p>
If you let the user change anything inside his userspace while higher privileged tasks are running, the user might just add data to the end of a file currently read by root and punch the data at the beginning so that he does not exceed his quota. The process reading the file (into / partition?) could end uptrying to read like 16TiB before the user has to try using collapse instead of punch to see if the root cronjob continues to read even more of the file.<br>
(Fortunately the user cannot directly see the offset of the root processes filehandle, so he must rather guess where the other process currently is, to do this type of attack)<br>
Is this attack vector now caused by PUNCH or COLLAPSE? Do we have to remove them just for beeing able to run root commands on userspace data while the user is able to work on it as is suggested here with symlinks?<br>
<p>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901501/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor901591></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 18, 2022 10:17 UTC (Mon) by <b>ras</b> (subscriber, #33059)
 [<a href=https://lwn.net/Articles/901591/>Link</a>]
 </p>
 <div class=FormattedComment>
The problem with symlinks could be summed up in one word: races.<br>
<p>
Parallelism is the hardest thing to get right in the programming world. POSIX offers no help whatsoever. It doesn't have transactions, and it doesn't have mandatory locks. Even the simplest of things like doing an atomic set of writes to a single file so hard we have the SQLite designer tell us to use it like fwrite(). Using an entire SQL library just to do reliable writes should be an absurd recommendation, but as things stand: he's right.<br>
<p>
Because it's near impossible to get right, there are many bugs, some have security implications, and thus POSIX's total non-support of transactions has the cause of CVE after CVE for literally decades. It's not just symlinks. We seen streams of CVE's over the downright trivial operation of creating a temporary file, and surprise surprise hard links have their share of CVE's too. Renames, copies, moves, deletes are all the same. If you can't be 100% sure of what the file system looks like when you execute them (and POSIX ensures you can never be sure if there is more than one thread), then the end result is likely to be a gamble.<br>
<p>
Or to put it another way, if POSIX did support transactions, most of the symlink CVE's he mentions, and all the need for all these xxxxat() operations would just vanish. Ergo, symlink's aren't the problem, and getting rid of them won't fix it.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901591/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor901777></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 19, 2022 13:35 UTC (Tue) by <b>mathstuf</b> (subscriber, #69389)
 [<a href=https://lwn.net/Articles/901777/>Link</a>]
 </p>
 <div class=FormattedComment>
Have there been systems with transactional filesystem APIs?<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901777/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor901804></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 19, 2022 14:59 UTC (Tue) by <b>ras</b> (subscriber, #33059)
 [<a href=https://lwn.net/Articles/901804/>Link</a>]
 </p>
 <div class=FormattedComment>
A quick google reveals most desktops are running one: <a href=https://en.wikipedia.org/wiki/Transactional_NTFS>https://en.wikipedia.org/wiki/Transactional_NTFS</a><br>
<p>
It's not clear if that still true, but it blows me away anyway.<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901804/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<div class=Comment>
<a name=CommAnchor901812></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 19, 2022 16:40 UTC (Tue) by <b>mathstuf</b> (subscriber, #69389)
 [<a href=https://lwn.net/Articles/901812/>Link</a>]
 </p>
 <div class=FormattedComment>
Given that Microsoft has declared it deprecated and may have it disappear in the future…it seems like a failed experiment on at least the deployment level.<br>
</div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901812/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
<a name=CommAnchor901809></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 19, 2022 16:24 UTC (Tue) by <b>kleptog</b> (subscriber, #1183)
 [<a href=https://lwn.net/Articles/901809/>Link</a>]
 </p>
 PostgreSQL has support for <a href=https://www.postgresql.org/docs/current/lo-implementation.html>transactional large objects</a>. To call it a filesystem is a bit of a stretch since objects only have numeric identifiers not names. However, they have permissions, and support open/close/seek/read/write and are all within a transaction. You could certainly build a complete transactional filesystem on top of it.
<p>
But this also shows the difficulty, given the amount of work database systems have to do to make transactions work while giving everyone a consistent view and making it perform. Then again, the problem space of filesystems is much simpler.
<p>
Even if we supported only transactional metadata changes (rename, move, create, unlink) would be a step up. Certainly being able the work on a fixed snapshot of the filesystem would be good enough for quite a lot of purposes (I think btrfs has this).
 </p></div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/901809/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div>
</div>
<a name=CommAnchor902059></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 21, 2022 17:50 UTC (Thu) by <b>kdbotts</b> (guest, #159822)
 [<a href=https://lwn.net/Articles/902059/>Link</a>]
 </p>
 <div class=FormattedComment>
I understand there are races involving symlinks, and I sympathize with the concern. But I hope everybody bears in mind:<br>
<p>
Symlinks have immense utility. They are essential and extremely valuable features of Linux and Unix, and have been for 40 years. Not just every distribution, but every deployment and pretty much every host intimately depend on symlinks. Breaking them is simply not an option. I find it hard to imagine a worse violation of "WE DO NOT BREAK USER SPACE!"<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/902059/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor902164></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 22, 2022 10:44 UTC (Fri) by <b>jwilk</b> (subscriber, #63328)
 [<a href=https://lwn.net/Articles/902164/>Link</a>]
 </p>
 <div class=FormattedComment>
The O_PATH|O_NOFOLLOW + /proc/self/fd/N trick can be also used to bind-mount over symlinks: <a href=https://lore.kernel.org/all/20191230052036.8765-1-cyphar@cyphar.com/>https://lore.kernel.org/all/20191230052036.8765-1-cyphar@...</a><br>
<p>
The linked mail from 2019 proposed removal of this feature, but AFAICS it still works, so I guess it's not going to be removed after all?<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/902164/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor902195></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 22, 2022 13:53 UTC (Fri) by <b>jdisnard</b> (subscriber, #90248)
 [<a href=https://lwn.net/Articles/902195/>Link</a>]
 </p>
 <div class=FormattedComment>
<p>
Where do bind mounts fit into the picture here? <br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/902195/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
<a name=CommAnchor902247></a>
<div class=CommentBox>
 <h3 class=CommentTitle>The trouble with symbolic links</h3>
 <div class=CommentBody>
 <p class=CommentPoster>Posted Jul 23, 2022 0:41 UTC (Sat) by <b>DimeCadmium</b> (guest, #157243)
 [<a href=https://lwn.net/Articles/902247/>Link</a>]
 </p>
 <div class=FormattedComment>
<font class=QuotedText>&gt; For a non-trivial application, for a regular person writing code on POSIX, you will have symlink races in your code.</font><br>
<p>
I think this overstates the amount of applications for which it actually matters. All you actually need to prevent symlink attacks is... other/untrusted users can't write to the directories you deal with or their parents. Which is the case for most applications: the directory they're operating in is owned by the user they're running as, and all of its parent directories are owned by the same user (or root).<br>
<p>
The most common case that brings symlink attacks into possibility, I think, is an application which runs as root and does operations in (for example) /tmp or another world-writeable directory. Other than that it's really only multi-user servers that matter. (For example, Apache was mentioned in the comments: Apache only has to care about symlinks because it's not running as the same user who owns the website-files, and could therefore read files that the user can't.)<br>
</p></div>
 </div>
 
 <div class=CommentReplyButton>
 <form action=/Articles/902247/comment method=post>
 <input type=submit value="Reply to this comment">
 </form>
 </div>
 <p>
 
</p></div>
</div> 
<div class="rightcol not-print">
<div id=azk93271_right_zone></div>
</div>
</div> 
 <br clear=all>
 <center>
 <p>
 <span class=ReallySmall>
 Copyright © 2022, Eklektix, Inc.<br>
 
 Comments and public postings are copyrighted by their creators.<br>
 Linux is a registered trademark of Linus Torvalds<br>
 </span>
 </p></center>
 
 
